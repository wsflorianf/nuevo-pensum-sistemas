---
import { type MateriaType } from '@/types/informacion'

interface Props extends MateriaType {}

//Props del componente
const { codigo, nombre, creditos, td, tc, ta, urlSyllabus, tipo } = Astro.props
---

<div class='materia' data-url={urlSyllabus} data-type={tipo} data-code={codigo}>
  <div class='cod'><span>Código: </span>{codigo}</div>
  <div class='pre'><span>Pre:</span></div>
  <div class='corr'><span>Corr:</span></div>
  <div class='creditos'><span>Créditos: </span>{creditos}</div>
  <div class='horas'>
    <div class='directo'><span>TD: </span>{td}</div>
    <div class='colaborativo'><span>TC: </span>{tc}</div>
    <div class='autonomo'><span>TA: </span>{ta}</div>
  </div>
  <div class={'nombre ' + tipo}>
    {nombre}
  </div>
</div>

<script>
  let mobile = {
    Android: function () {
      return navigator.userAgent.match(/Android/i)
    },
    BlackBerry: function () {
      return navigator.userAgent.match(/BlackBerry/i)
    },
    iOS: function () {
      return navigator.userAgent.match(/iPhone|iPad|iPod/i)
    },
    Opera: function () {
      return navigator.userAgent.match(/Opera Mini/i)
    },
    Windows: function () {
      return navigator.userAgent.match(/IEMobile/i)
    },
    any: function () {
      return (
        mobile.Android() ||
        mobile.BlackBerry() ||
        mobile.iOS() ||
        mobile.Opera() ||
        mobile.Windows()
      )
    },
  }

  

  //Se seleccionan todas las materias para asignarles el evento necesario según corresponda el tipo (EX, AI o el resto)
  document.querySelectorAll('.materia').forEach((materia) => {
    //Se obtiene el tipo del atributo data-type
    let tipo = materia.getAttribute('data-type')

    //Si es EX no se le asigna eventListener
    if (tipo == 'EX') {
    }
    //Para AI se redirige hacia las opciones posibles para este espacio
    else if (tipo == 'AI') {
      materia.addEventListener('click', () => {
        alert(materia.getAttribute('data-code'))
      })
    }
    //Para las demás se muestra una ventana modal con su syllabus
    else {
      materia.addEventListener('click', () => {

        let url = materia.getAttribute('data-url') || ''

        if(mobile.any()){
          window.location.replace(url)
        }
        else{
        //Se lleva hacia la parte superior del sitio
        scrollTo({ top: 0 })

        //Se quita temporalmente el scroll al sitio
        document.body.style.overflow = 'hidden'

        const pdfView = document.querySelector('#modal-pdf')
        const iframe = document.createElement('iframe')

        //Se establece el modal como abierto
        pdfView?.setAttribute('data-mode', 'open')

        //Se agrega el iframe para visualizar el PDF con su respectiva url, la url se obtiene del atributo data-url de la materia
        iframe.src = url
        pdfView?.appendChild(iframe)
      }
      })
    }
  })
</script>

<style>
  a {
    display: block;
    text-decoration: none;
    color: black;
  }

  .materia {
    border: 1px black solid;
  }

  .materia div {
    padding: 0 4px;
    width: 100%;
    border: 1px black solid;
  }

  span {
    font-weight: 500;
  }

  .materia {
    display: flex;
    flex-direction: column;
    font-size: 0.7rem;
    height: 140px;
  }

  .nombre {
    display: grid;
    place-content: center;
    text-align: center;
    flex-grow: 1;
    font-size: 0.8rem;
    font-weight: 600;
    padding: 2px;
    justify-self: center;
  }

  .horas {
    display: flex;
    justify-content: space-between;
  }

  .horas div {
    border: none;
  }

  .CO {
    background-color: #00b0f0;
  }

  .CB {
    background-color: #ffff00;
  }

  .BI {
    background-color: #93d150;
  }

  .AI {
    background-color: #bfbfbf;
  }

  .EX {
    background-color: #fcd5b4;
  }

  @media screen and (min-width: 800px) {
    .materia {
      width: 100%;
      transition: 0.2s all;
    }

    .materia:hover {
      cursor: pointer;
      transform: scale(1.05);
      box-shadow: 0 0 8px 0.5px rgb(0, 0, 0, 0.5);
    }
  }
</style>
